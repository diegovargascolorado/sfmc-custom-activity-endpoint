<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Enviar a Webhook</title>
    <script src="https://unpkg.com/postmonger@0.0.15/postmonger.js"></script>
    <style>
        body { font-family: Arial; padding:20px; }
        input { width:100%; padding:8px; margin-top:10px; }
        button { margin-top:15px; padding:10px; width:100%; }
    </style>
</head>
<body>

<h3>Enviar datos a Webhook</h3>

<label>URL del Webhook</label>
<input type="text" id="webhookUrl" placeholder="https://webhook.site/xxxx" />

<button onclick="save()">Guardar</button>

<script>
    var connection = new Postmonger.Session();
    var payload = {};

    connection.on('initActivity', function (data) {
        payload = data;

        if (payload.configurationArguments &&
            payload.configurationArguments.webhookUrl) {
            document.getElementById('webhookUrl').value =
                payload.configurationArguments.webhookUrl;
        }

        connection.trigger('ready');
    });

    connection.on('clickedDone', function () {
        save(true);
    });

    function save(close) {

        var url = document.getElementById('webhookUrl').value;

        if (!url) {
            alert("Debes ingresar una URL");
            return;
        }

        payload.configurationArguments = payload.configurationArguments || {};
        payload.configurationArguments.webhookUrl = url;

        payload.metaData = payload.metaData || {};
        payload.metaData.isConfigured = true;

        connection.trigger('updateActivity', payload);

        if (close) {
            connection.trigger('done');
        }
    }
</script>

</body>
</html>
